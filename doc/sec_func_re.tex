\section{ФУНКЦИОНАЛЬНОЕ ПРОЕКТИРОВАНИЕ}
\label{sec:func}


\subsection{Алгоритм работы модуля выделения информационных образов из музыкального произведения}
    
На ход модуля чтения музыкального произведения подаётся путь к музыкальному произведению. Файл с расширением “.wav” считывается в оперативную память в формате массива отсчётов. Файл с иным расширением конвертируются в WAV формат. 

В модуле препроцессинга и нарезки от музыкального трека отрезается 10\% длины с начала и конца трека. В случае, если трек является многоканальным, то он приводится к одноканальному посредством чередованием правого и левого канала. Данные нормализуются по МО и СКО. Затем используется экспоненциальное сглаживание с коэффициентом сглаживания 0,99. Результат нарезается на фрагменты по 5 секунд с перекрытием в 0,5 секунды.

В модуле получения частотно-временного представления используется оконное преобразование Фурье с окном Хэмминга шириной в 10 миллисекунд. Также в модуле для получения ритмического образа используется вейвлет Добеши каскадным алгоритмом с количеством каскадов 4. Результат каждого каскада сглаживается экспоненциальным сглаживанием с коэффициентом сглаживания 0,97, передискретизируется с уменьшением дискретизации в 16 раз, нормализуется по МО. Затем результаты поэлементно складываются и вычисляется автокорелляция. Результатом работы модуля является спектрограмма и коррелограмма.

В модуле выделения информационных образов из временного представления сигнала выделяется временной, из спектрограммы - спектральный образ по каждому срезу спектрограммы, из коррелограммы - ритмический. Мел-кепстральные коэффициенты считаются по окнам в 5 миллисекунд. 

В модуле обработки информационных образов по всем образам кроме временного считается МО, СКО, коэффициент ассиметрии, коэффициент эксцесса.

В базу данных записывается информационный образ в формате: название произведения, номер фрагмента и результат работы модуля обработки информационных образов.  

В модуле классификации информационных образов используются набор стандартных алгоритмов классификации из библиотеки scikit-learn с параметрами по умолчанию:
\begin{enumerate}
\item метод ближайших соседей с k = 3;
\item метод опорных векторов с полиномиальным ядром;
\item дерево принятия решений;
\item случайный лес;
\item нейронная сеть прямого распространения с 1000 нейронов на скрытом слое;
\item adaBoost;
\itemнаивный баесовский классификатор;
\item квадратичный дискриминант.
\end{enumerate}

Для оценки качества классификации использовался скользящий контроль количеством разбиений равным 10 и алгоритмом разбиения stratified k-fold. Также для каждого классификатора строится матрица ошибок.

В модуле визуализации используется алгоритм t-sne.Это нелинейный метод уменьшения размерности, который особенно хорошо подходит для вложения высокоразмерных данных в пространство двух или трех измерений, которое затем можно визуализировать на диаграмме рассеяния. В частности, он моделирует каждый высокоразмерный объект с помощью двух- или трехмерной точки таким образом, что аналогичные объекты моделируются соседними точками, а разнородные объекты моделируются удаленными точками. Данные визуализируются в 2д и 3д графики. 


\subsection{Реализация внутренних модулей}
Рассмотрим в деталях функциональные части системы: для этого произведем детальный анализ компонентов, модулей, составляющих их классов и отдельных методов, реализующих логику программы.



Структурно система подразделяется на ряд модулей , объединенных под общим модулем с названием \texttt{MainModule}. Дальнейшее разделение ведется по следующим модулям:
\begin{enumerate}[label=\arabic*.]
\item{Модуль чтения музыкального произведения - \texttt{WavModule}.}
\item{Модуль препроцессинга и нарезки - \texttt{PreprocessingModule}.}
\item{Модуль получения частотно-временного представления сигнала -
 
\texttt{SpectralTransformerModule}.}
\item{Модуль извлечения информационных образов -

\texttt{FeatureExtractorModule}.}
\item{Модуль обработки информационных образов - 

\texttt{FeatureProcessingModule}. }
\item{База данных информационных образов - \texttt{DatabaseModule}.}
\item{Модуль жанровой классификации музыкального произведения -

\texttt{GenreClassificationModule}.}
\item{Модуль визуализации - \texttt{VisualizeDataModule}.}
\end{enumerate}

\subsubsection{Класс \texttt{WavModule}}

Класс \texttt{WavModule} предназначен для преобразования MP3 к формату WAV и считывании данных в Numpy-массив. 

Класс \texttt{WavModule} имеет следующие методы:

\begin{itemize}
\item{\texttt{create_wav(file_name)} -- процедура, которая принимает на вход путь к MP3-файлу и с помошью стандартной библиотеки Python вызывает либо bash-скрипт в случае запуска в операционной системе Linux, либо batch-скрипт в случае запуска в операционной системе Windows, который использует консольное приложение Lame для преобразования MP3-файла в WAV формат}
\item{\texttt{read_wav(filename, label)} -- метод, который считывает файл формата WAV и сохраняет данные в класс \texttt{Track}}
\end{itemize}

\subsubsection{Класс \texttt{PreprocessingModule}}

Класс \texttt{PreprocessingModule} предназначен для первичной обработки трека, которая включает в себя приведения стерео звука к моно, нормализация по МО и СКО, 
удаления заданного процента трека с начала и с конца, экспоненциальное сглаживание и нарезка трека на фрагменты. В конструкторе задаётся коэффициент сглаживания, процент пересечения фрагментов, процент отсечения трека с начала, процент отсечения трека с конца, размер фрагмента в секундах.

Класс \texttt{PreprocessingModule} имеет следующие методы и поля:

\begin{itemize}
\item{Поле \texttt{alpha} -- коэффициент сглаживания, который может принимать значения от 0 до 1.}
\item{Поле \texttt{overlap} -- процент пересечения фрагментов.}
\item{Поле \texttt{cut_start} -- процент отсечения трека с начала трека}
\item{Поле \texttt{cut_end} -- процент отсечения трека с конца трека}
\item{Поле \texttt{frame_size_sec} -- размер фрагментов в секундах}
\item{\texttt{stereo_to_mono(track)} -- метод, который преобразует стерео звук к моно с помощью чередования правого и левого канала}
\item{\texttt{scale(track)} -- метод, который нормализует данные по МО и СКО
\item{\texttt{filter(track)} -- метод, который преобразовывает данные искользуя экспоненциальное сглаживание:
\begin{equation}\label{eq:sfm}
s_t = \begin{cases} 
c_1, & t_1 = 0. \\
s_{t} + \alpha * (c_t - s_{t-1}), & t > 0
\end{cases} 
\end{equation}
где - $\alpha$ - коэффициент сглаживание заданные в поле \texttt{alpha}
\item{\texttt{cutting(track)} -- метод, который отсекает процент данных трека с начала и конца, который задаётся полями \texttt{cut_start} и \texttt{cut_end}
\item{\texttt{framing(track)} -- метод, который нарезает трека на фрагменты длинной заданной полем \texttt{frame_size_sec} и перекрытием заданным полем \texttt{overlap}.
\end{itemize}


